<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Image Compression • Smart File Tools</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.7.1/dist/jszip.min.js"></script>
</head>
<body>
  <nav class="sub-nav">
    <a href="index.html" class="back">← Back to Home</a>
    <a href="image-compression.html" class="active">Image Compression</a>
  </nav>
  <header class="sub-header"><h1>Image Compression</h1></header>
  <main class="subpage">
    <p class="upload-info">
      You can upload up to <strong>3 images</strong> per batch.<br/>
      <span class="highlight">Supported formats:</span> JPG, PNG, GIF, WEBP, BMP.
    </p>
    <div class="drop-area" id="dropArea">
      <div class="icon">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect x="3" y="3" width="18" height="18" rx="2" stroke="#58d3f7" stroke-width="2"/>
          <circle cx="8" cy="8" r="1.5" fill="#58d3f7"/>
          <path d="M3 21L8.5 13L13.5 17.5L21 9V21H3Z" fill="#58d3f7"/>
        </svg>
      </div>
      <p>Drag & drop images here, or click to select</p>
      <input type="file" id="fileInput" accept="image/*" multiple>
    </div>
    <div class="file-info" id="fileInfo" style="display:none;">
      <svg class="file-icon" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="#58d3f7" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="2"/>
        <circle cx="8" cy="8" r="1.5"/>
        <path d="M3 21L8.5 13L13.5 17.5L21 9V21H3Z"/>
      </svg>
      <ul id="fileNames" class="file-names"></ul>
    </div>
    <div class="quality-options">
      <label><input type="radio" name="quality" value="0.3"> Low</label>
      <label><input type="radio" name="quality" value="0.6" checked> Medium</label>
      <label><input type="radio" name="quality" value="0.9"> High</label>
    </div>
    <div class="actions">
      <button id="compressBtn" class="action-btn">Compress Images</button>
      <button id="downloadZipBtn" class="action-btn zip-btn" style="display:none;">Download ZIP</button>
      <button id="resetBtn" class="action-btn reset-btn">Reset</button>
    </div>
    <div id="progress" class="progress"></div>
    <section class="result">
      <h2>Result</h2><div id="output"></div>
    </section>
  </main>
  <footer><p>&copy; 2025 Smart File Tools</p></footer>
  <script>
    const dropArea       = document.getElementById('dropArea');
    const fileInput      = document.getElementById('fileInput');
    const fileInfo       = document.getElementById('fileInfo');
    const fileNamesEl    = document.getElementById('fileNames');
    const compressBtn    = document.getElementById('compressBtn');
    const downloadZipBtn = document.getElementById('downloadZipBtn');
    const resetBtn       = document.getElementById('resetBtn');
    const output         = document.getElementById('output');
    const progressEl     = document.getElementById('progress');
    const maxFiles       = 3;
    let selectedFiles    = [];
    let compressedFiles  = [];

    fileInput.addEventListener('mousedown', ()=>fileInput.value='');
    dropArea.addEventListener('dragover',e=>{e.preventDefault();dropArea.classList.add('hover');});
    dropArea.addEventListener('dragleave',()=>dropArea.classList.remove('hover'));
    dropArea.addEventListener('drop',e=>{e.preventDefault();dropArea.classList.remove('hover');processFiles(e.dataTransfer.files);});
    fileInput.addEventListener('change',()=>processFiles(fileInput.files));

    function processFiles(list){
      const ok=/\.(jpe?g|png|gif|webp|bmp)$/i;
      const arr=[...list],valid=arr.filter(f=>ok.test(f.name)),bad=arr.filter(f=>!ok.test(f.name));
      if(bad.length)alert(`Unsupported:\n${bad.map(f=>f.name).join('\n')}`);
      selectedFiles=[...selectedFiles,...valid].filter((v,i,a)=>a.findIndex(t=>t.name===v.name&&t.size===v.size)===i);
      if(selectedFiles.length>maxFiles){alert(`Up to ${maxFiles} images only.`);selectedFiles=selectedFiles.slice(0,maxFiles);}
      const dt=new DataTransfer();selectedFiles.forEach(f=>dt.items.add(f));fileInput.files=dt.files;
      if(!selectedFiles.length)fileInfo.style.display='none';else{fileNamesEl.innerHTML=selectedFiles.map(f=>`<li>${f.name}</li>`).join('');fileInfo.style.display='flex';}
    }

    compressBtn.addEventListener('click',async()=>{
      if(!selectedFiles.length)return alert('Select at least one image.');
      const quality=parseFloat(document.querySelector('input[name="quality"]:checked').value);
      output.innerHTML='';progressEl.textContent='';downloadZipBtn.style.display='none';compressedFiles=[];
      for(let i=0;i<selectedFiles.length;i++){
        const f=selectedFiles[i];
        progressEl.textContent=`Compressing ${i+1}/${selectedFiles.length}: ${f.name}`;
        const dataURL=await new Promise(r=>{const R=new FileReader();R.onload=e=>r(e.target.result);R.readAsDataURL(f);});
        const img=new Image();await new Promise(r=>{img.onload=r;img.src=dataURL;});
        const c=document.createElement('canvas');c.width=img.width;c.height=img.height;c.getContext('2d').drawImage(img,0,0);
        let mime=f.type; if(!['image/png','image/jpeg','image/webp'].includes(mime))mime='image/jpeg';
        const blob=await new Promise(r=>c.toBlob(r,mime,quality));
        const origKB=(f.size/1024).toFixed(1),compKB=(blob.size/1024).toFixed(1),url=URL.createObjectURL(blob);
        const a=document.createElement('a'),base=f.name.replace(/\.[^/.]+$/,''),ext=mime.split('/')[1];
        a.download=`${base}-compressed.${ext}`;a.href=url;a.textContent=`${f.name} (${origKB}KB → ${compKB}KB)`;a.className='download-btn';
        output.appendChild(a);output.appendChild(document.createElement('br'));
        compressedFiles.push({name:`${base}-compressed.${ext}`,blob});
      }
      progressEl.textContent='Compression complete.';downloadZipBtn.style.display='inline-block';
    });

    downloadZipBtn.addEventListener('click',async()=>{
      if(!compressedFiles.length)return;
      progressEl.textContent='Generating ZIP…';
      const zip=new JSZip();compressedFiles.forEach(f=>zip.file(f.name,f.blob));
      const zblob=await zip.generateAsync({type:'blob'}),url=URL.createObjectURL(zblob);
      const link=document.createElement('a');link.href=url;link.download='compressed_images.zip';
      document.body.appendChild(link);link.click();document.body.removeChild(link);URL.revokeObjectURL(url);
      progressEl.textContent='';
    });

    resetBtn.addEventListener('click',()=>{
      selectedFiles=[];compressedFiles=[];fileInput.value='';fileInfo.style.display='none';
      output.innerHTML='';progressEl.textContent='';downloadZipBtn.style.display='none';
      document.querySelector('input[name="quality"][value="0.6"]').checked=true;
    });
  </script>
</body>
</html>
